<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>AcheTece - Portal de Malharias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Ícone da aba (favicon) -->
  <link rel="icon" type="image/x-icon" href="/static/favicon_final.ico">
  <link rel="icon" type="image/png" href="/static/favicon_final.png">

  <!-- CSS principal -->
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --roxo:#8A00FF; --roxo-hover:#A63DFF; --preto:#000;
      --procura-bg:#F2E8FF; --procura-fg:#7A1BFF;
      --malharia-bg:#E6FCF4; --malharia-fg:#0BA98B;
    }

    /* ===== HEADER ===== */
    .navbar{overflow:visible;padding-top:6px;padding-bottom:6px;display:flex;align-items:center;}
    .header-left,.header-right{display:flex;align-items:center;}
    .header-right{margin-left:auto;gap:16px;}

    /* Botões do cabeçalho */
    .hdr-actions{display:flex;align-items:center;gap:10px}
    .btn-entrar,.btn-anunciar{
      height:40px;line-height:40px;border-radius:9999px;padding:0 18px;font-weight:700;
      text-decoration:none;display:inline-flex;align-items:center;gap:10px;white-space:nowrap;
    }
    .btn-entrar{background:#fff;color:#222;border:1.5px solid #D9DCE1;}
    .btn-entrar:hover{background:#fafafa}
    .btn-anunciar{background:#F28C00;color:#fff;border:0;}
    .btn-anunciar:hover{background:#E57F00}
    .btn-anunciar svg{width:18px;height:18px;display:block;fill:none;stroke:#fff;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;}

    @media (max-width:820px){.hdr-actions{display:none}}

    .hamburger{display:inline-flex;flex-direction:column;align-items:center;justify-content:center;width:40px;height:40px;border:none;background:transparent;cursor:pointer;}
    .hamburger span{display:block;width:20px;height:2px;background:var(--preto);border-radius:2px;}
    .hamburger span+span{margin-top:4px;}
    @media (max-width:768px){.hamburger{width:32px;height:32px}.hamburger span{width:18px}.hamburger span+span{margin-top:3px}}

    /* ===== PROMO ===== */
    .promo-bar{background:var(--preto);color:#fff;display:flex;align-items:center;justify-content:center;gap:12px;padding:6px 10px;font-size:14px;line-height:1.2;}
    .promo-cta{display:inline-block;background:var(--roxo);color:#fff;text-decoration:none;padding:6px 10px;border-radius:8px;font-weight:600;white-space:nowrap;transition:.2s;}
    .promo-cta:hover{background:var(--roxo-hover);transform:translateY(-1px);}
    @media (max-width:600px){.promo-bar{flex-wrap:wrap;row-gap:6px}}

    /* ===== OVERLAY (MENU) – resumo dos estilos existentes ===== */
    .overlay-menu{position:fixed;inset:0;z-index:1000;display:none;}
    .overlay-menu.is-open{display:block;}
    .overlay-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);}
    .overlay-panel{position:relative;margin:40px auto;width:min(960px,calc(100% - 24px));background:#fff;border-radius:20px;overflow:hidden;display:flex;flex-direction:column;max-height:calc(100% - 80px);}
    .overlay-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid #eee;}
    .overlay-content{display:grid;grid-template-columns:1fr 1fr;gap:28px;padding:22px;overflow:auto;}
    .section-title--login{font-weight:700;font-size:16px;line-height:1.1;color:#111;text-transform:none;}
    .social-row{display:flex;gap:12px;flex-wrap:wrap}
    .btn-google,.btn-facebook{width:190px;height:46px;padding:0 16px;border-radius:999px;display:flex;align-items:center;gap:10px;box-sizing:border-box;font-size:14px;font-weight:500;}
    .btn-google{background:#f7f7f7;border:1px solid #dadce0;color:#3c4043;}
    .btn-facebook{background:#1877F2;color:#fff;border:0;}
    .form-subtitle{font-weight:700;font-size:16px;margin:28px 0 8px;}
    .access-fields{width:392px;max-width:100%;padding-top:8px;}
    .input{width:100%;height:48px;border-radius:999px;border:1px solid #e6e6e6;padding:0 16px;margin-bottom:10px;font-size:14px;background:#eaf1ff;color:#111;}
    .links-inline{margin-top:-4px;margin-bottom:14px;}
    .links-inline a{font-size:12px;color:#333;text-decoration:none;}
    .btn-primary{width:392px;max-width:100%;height:54px;border-radius:999px;border:0;background:#8A00FF;color:#fff;font-weight:800;font-size:16px;}
    .signup-text{margin-top:8px;font-size:12px;color:#000;}
    @media (max-width:520px){.btn-google,.btn-facebook,.access-fields,.btn-primary{width:100%}}

    /* ===== LAYOUT (FILTROS + RESULTADOS) ===== */
    .page-outer{max-width:1280px;margin:0 auto;padding:0 16px;}
    .search-layout{display:grid;grid-template-columns:300px 1fr;gap:24px;align-items:start;margin:10px 0 0;}
    @media (max-width:1024px){.search-layout{grid-template-columns:1fr}}

    /* Filtros (esquerda) */
    .filters-panel{border:1px solid #eee;border-radius:14px;padding:16px;background:#fff;position:sticky;top:56px;max-height:calc(100vh - 72px);overflow:auto;z-index:10;}
    .filters-title{margin:0 0 12px;font-size:18px;font-weight:700;}
    .filter-field{margin-bottom:12px;}
    .filter-field label{display:block;font-size:14px;margin-bottom:6px;color:#444;}
    .filter-field select{width:100%;height:40px;padding:8px 10px;border:1px solid #ccc;border-radius:10px;background:#fff;color:#333;}
    .filter-actions .btn-primary{width:100%;}
    .link-reset{display:inline-block;margin-top:10px;font-size:14px;color:#6a6a6a;text-decoration:underline;}
    @media (max-width:1024px){
      .filters-panel{position:fixed;left:0;top:0;bottom:0;width:min(90%,360px);max-width:90vw;border-radius:0;padding:16px;transform:translateX(-110%);transition:transform .2s ease;z-index:1001;max-height:none;overflow:auto}
      .filters-panel.is-open{transform:translateX(0)}
      body.filters-open{overflow:hidden}
    }

    /* =========================
       CONTEÚDO (formulário original)
       ========================= */
    .container {
      max-width: 500px;
      margin: 32px auto 60px;
      background: #fff;
      padding: 32px;
      border-radius: 12px;
      box-shadow: none !important;
    }
    h1.titulo {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 24px;
    }
    .formulario label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      font-size: 14px;
    }
    .formulario input,
    .formulario select {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    /* Placeholder azul no select */
    select option[disabled] {
      color: #003bb3; /* azul AcheTece */
      font-weight: 500;
    }
    .formulario button.botao-salvar {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background-color: #8A00FF;
      color: white;
      font-weight: bold;
      font-size: 14px;
      cursor: pointer;
    }
    .formulario button.botao-salvar:hover {
      background-color: #8A00FF;
    }

    .mensagem-erro {
      background-color: #ffe6e6;
      color: #b30000;
      border: 1px solid #ff4d4d;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      animation: aparecer 0.4s ease-in-out;
    }
    .mensagem-erro .icone {
      font-size: 30px;
      display: block;
      margin-bottom: 10px;
    }
    .mensagem-erro .botao-voltar {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #8A00FF;
      color: #fff;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.2s ease;
      cursor: pointer;
    }
    .mensagem-erro .botao-voltar:hover {
      background-color: #8A00FF;
    }
    .erro-campo { border: 2px solid red; background-color: #fff5f5; }
    .mensagem-campo {
      color: red;
      font-size: 13px;
      margin-top: -10px;
      margin-bottom: 12px;
    }
    @keyframes aparecer {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    /* ===== CTA + Rodapé (do fale_conosco) ===== */
    .cta-bar{background:#000;color:#fff;padding:20px 16px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;border-top:1px solid rgba(255,255,255,0.06);margin-top:32px;justify-content:flex-start;}
    .cta-text h3{margin:0 0 4px 0;font-size:18px;font-weight:700;line-height:1.2;}
    .cta-text p{margin:0;font-size:15px;opacity:.9;}
    .cta-btn{display:inline-block;background:#fff;color:#000;text-decoration:none;padding:10px 22px;border-radius:9999px;font-weight:700;white-space:nowrap;}
    .cta-btn:hover{background:#f2f2f5;transform:translateY(-1px);}

    .site-footer{background:#fff;color:#211a2a;border-top:1px solid #eee;padding:18px 16px 28px;}
    .footer-inner{max-width:1180px;margin:0 auto;display:grid;grid-template-columns:auto 1fr;gap:20px 28px;align-items:start;}
    .footer-brand img{height:44px;width:auto;display:block;}
    .footer-cols{display:grid;grid-template-columns:repeat(2,minmax(180px,240px));gap:12px 28px;}
    .footer-col h4{margin:0 0 8px 0;font-size:14px;font-weight:700;color:#251c33;}
    .footer-col ul{list-style:none;margin:0;padding:0;}
    .footer-col li+li{margin-top:6px;}
    .footer-col a{color:#2a2535;text-decoration:none;font-size:14px;}
    .footer-col a:hover{text-decoration:underline;}
  </style>
</head>
<body>

  <!-- Faixa preta estreita no topo -->
  <section class="promo-bar" aria-label="Oferta para malharias">
    <span><strong>Malharia:</strong> receba agora novos pedidos por apenas <strong>R$49,90/mês</strong>.</span>
    <a class="promo-cta" href="/malharia_info">Saiba como</a>
  </section>

  <!-- Cabeçalho -->
  <header class="navbar">
    <div class="header-left">
      <div class="logo">
        <img src="/static/logo.jpg" alt="Logo AcheTece" decoding="async" fetchpriority="high">
      </div>
    </div>

    <div class="header-right">
      <div class="hdr-actions">
        <a href="/login" class="btn-entrar">Entrar</a>
        <a href="/cadastrar_empresa" class="btn-anunciar" aria-label="Cadastrar malharia">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14"></path><circle cx="19" cy="5" r="1.5" fill="#fff" stroke="none"></circle></svg>
          <span>Cadastrar malharia</span>
        </a>
      </div>
      <button class="hamburger" id="hamburgerBtn" type="button" aria-label="Abrir menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- Barra mobile (estilo OLX) -->
  <div class="mobile-controls" aria-hidden="false">
    <div class="mobile-controls-inner">
      <div class="location-row">
        <span aria-hidden="true">📍</span>
        <label for="loc-mobile" class="sr-only">Localização</label>
        <select id="loc-mobile" name="localizacao">
          <option value="">Buscando em todo o Brasil</option>
          <option value="SC">Santa Catarina</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="PR">Paraná</option>
        </select>
      </div>
      <div class="toolbar-row">
        <button class="btn-filtros" id="toggleFiltersMobile" aria-controls="filtersPanel" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M6 12h12M10 18h4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
          Filtros
        </button>
        {% set ativos = [] %}
        {% for k,v in filtros.items() %}{% if v %}{% set _ = ativos.append(k|capitalize ~ ': ' ~ v) %}{% endif %}{% endfor %}
        <div class="filter-pill" title="{{ ativos|join(', ') if ativos else 'Todos os teares' }}">
          {{ ativos|join(' • ') if ativos else 'Todos os teares' }}
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ESQ = FILTROS | DIR = RESULTADOS ===== -->
  <div class="page-outer">
    <div class="search-layout">

      <!-- COLUNA ESQUERDA: FILTROS -->
      <aside class="filters-panel" id="filtersPanel">
        <h2 class="filters-title">Filtrar teares</h2>
        <form method="POST" class="formulario" action="{{ url_for('index') }}">
          {% for campo, opcoes_campo in opcoes.items() %}
            <div class="filter-field">
              <label for="{{ campo }}">{{ campo|capitalize }}</label>
              <select name="{{ campo }}" id="{{ campo }}">
                <option value="">-- Todos --</option>
                {% for opcao in opcoes_campo %}
                  <option value="{{ opcao }}" {% if filtros[campo] == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
          <div class="filter-actions">
            <button type="submit" class="btn-primary">Buscar</button>
            <a href="{{ url_for('index') }}" class="link-reset">Limpar</a>
          </div>
        </form>
      </aside>

      <!-- ===== Localização (igual ao cadastrar_empresa), COLUNA DIREITA ===== -->
      <div class="localizacao-box">
        <h3 class="localizacao-titulo">Localização</h3>
      
        <label for="estado_lookup">Estado</label>
        <select id="estado_lookup" data-name-target="estado">
          <option value="" disabled selected>Selecione o estado</option>
          {% for uf in estados %}
            <option value="{{ uf }}">{{ uf }}</option>
          {% endfor %}
        </select>
      
        <label for="cidade_lookup">Cidade</label>
        <select id="cidade_lookup" data-name-target="cidade" disabled
                data-inicial="">
          <option value="" disabled selected>Selecione a cidade</option>
        </select>
      
        <!-- OPCIONAL (seguro para não conflitar com a coluna esquerda):
             estes inputs “espelho” só serão preenchidos por JS.
             Se o seu formulário da direita já tiver <input name="estado/cidade">, remova estes dois. -->
        <input type="hidden" name="estado" id="estado_hidden">
        <input type="hidden" name="cidade" id="cidade_hidden">
      </div>


        </section>

        <!-- RESULTADOS -->
        <header class="results-head">
          <h1>Teares disponíveis</h1>
          <div class="results-sub">
            {% set _total = total_resultados if total_resultados is defined else (resultados|length if resultados else 0) %}
            {% if _total and _total > 0 %}
              1 - {{ resultados|length if resultados else 0 }} de {{ _total }} resultados
            {% else %}
              Ajuste os filtros para ver resultados.
            {% endif %}
          </div>

          <div class="results-toolbar">
            <label for="ordenar" style="font-weight:600;color:#333">Ordenar por</label>
            <select id="ordenar" class="select" name="ordenar" onchange="location.search = updateQueryString('ordenar', this.value)">
              {% set ord = request.args.get('ordenar', 'relevancia') %}
              <option value="relevancia" {% if ord=='relevancia' %}selected{% endif %}>Mais relevantes</option>
              <option value="novos" {% if ord=='novos' %}selected{% endif %}>Mais recentes</option>
              <option value="antigos" {% if ord=='antigos' %}selected{% endif %}>Mais antigos</option>
            </select>
          </div>
        </header>

        <section id="busca" class="results-panel">
          {% if resultados %}
            <div class="tabela-container">
              {{ tabela_html|safe if tabela_html is defined else '' }}
            </div>

            <div class="paginacao">
              {% if pagina > 1 %}
                <a href="?pagina={{ pagina - 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">← Anterior</a>
              {% endif %}
              Página {{ pagina }} de {{ total_paginas }}
              {% if pagina < total_paginas %}
                <a href="?pagina={{ pagina + 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">Próxima →</a>
              {% endif %}
            </div>

            <form action="/exportar" method="get">
              {% for campo, valor in filtros.items() %}
                {% if valor %}
                  <input type="hidden" name="{{ campo }}" value="{{ valor }}">
                {% endif %}
              {% endfor %}
              <button type="submit" class="btn-primary" style="width:auto;padding:10px 16px;border-radius:12px">Exportar CSV</button>
            </form>
          {% else %}
            <div style="background:#fff;border:1px solid #eee;border-radius:12px;padding:18px">
              <strong>Nenhum resultado</strong><br>
              Tente flexibilizar alguns filtros ou limpar a localização.
            </div>
          {% endif %}
        </section>

      </div><!-- /right-col -->
    </div><!-- /search-layout -->
  </div><!-- /page-outer -->

  <!-- OVERLAY (menu) -->
  <div id="overlayMenu" class="overlay-menu" aria-hidden="true">
    <div class="overlay-backdrop" data-close></div>
    <section class="overlay-panel" role="dialog" aria-modal="true" aria-labelledby="overlayMenuTitle">
      <header class="overlay-header">
        <h2 id="overlayMenuTitle">Menu</h2>
        <button class="overlay-close" type="button" aria-label="Fechar" data-close>×</button>
      </header>

      <div class="overlay-content">
        <!-- Conteúdo igual às versões anteriores (login, atalhos etc.) -->
        <div class="overlay-col">
          <h3 class="section-title section-title--login">Entrar ou criar conta</h3>

          <div class="social-row">
            <button class="btn-google" onclick="location.href='/login_google'">
              <img src="/static/icone_google.png" alt="Google">
              <span class="g-text">Entrar com Google</span>
            </button>

            <button class="btn-facebook" onclick="alert('Conectar Facebook em breve')">
              <span class="fb-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fff">
                  <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 5 3.66 9.12 8.44 9.88v-6.99H8.08v-2.9h2.36V9.83c0-2.33 1.39-3.62 3.52-3.62 1.02 0 2.09.18 2.09.18v2.3h-1.18c-1.17 0-1.54.73-1.54 1.48v1.78h2.63l-.42 2.9h-2.21v6.99C18.34 21.12 22 17 22 12z"/>
                </svg>
              </span>
              <span>Entrar com Facebook</span>
            </button>
          </div>

          <h3 class="form-subtitle">Dados de acesso</h3>
          <div class="access-fields">
            <input type="email" placeholder="Email de login..." class="input" autocomplete="username">
            <input type="password" placeholder="Senha de acesso..." class="input" autocomplete="current-password">
            <div class="links-inline"><a href="/esqueci_senha">Esqueci minha senha</a></div>
            <button class="btn-primary" onclick="location.href='/login'">Entrar</button>
            <div class="signup-text">Não tem cadastro? <a href="/cadastrar_empresa">Crie sua conta aqui</a></div>
          </div>
        </div>

        <div class="overlay-col">
          <h3 class="section-title--simple">Facilidades AcheTece</h3>
          <div class="cards-row">
            <a class="mini-card procura" href="{{ url_for('index') }}#busca">
              <div class="mini-card-ico">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="6.8"></circle>
                  <line x1="15.5" y1="15.5" x2="20" y2="20"></line>
                </svg>
              </div>
              <div class="mini-card-title">Procuro Malharia</div>
            </a>
            <a class="mini-card malharia" href="/malharia_info">
              <div class="mini-card-ico">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M3 20V9l6 3V9l6 3V6h3v14H3z"/>
                </svg>
              </div>
              <div class="mini-card-title">Sou Malharia</div>
            </a>
          </div>

          <h3 class="section-title--simple mt">Mais opções</h3>
          <nav class="list-links">
            <a class="list-item" href="/cadastrar_empresa">
              <span class="list-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 20V9l6 3V9l6 3V6h3v14H3zM5 18h2v-2H5v2zm0-4h2v-2H5v2zm4 4h2v-2H9v2zm0-4h2v-2H9v2zm4 4h2v-2h-2v2z"/>
                </svg>
              </span>
              <span class="list-text">Cadastrar minha malharia</span>
              <span class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 6l6 6-6 6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </span>
            </a>

            <a class="list-item" href="{{ url_for('quem_somos') }}">
              <span class="list-icon"><img src="/static/logo_simbolo.png" alt="AcheTece" width="28" height="28" style="display:block"></span>
              <span class="list-text">Conheça o AcheTece</span>
              <span class="arrow"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 6l6 6-6 6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
            </a>

            <a class="list-item" href="https://wa.me/5547999999999" target="_blank" rel="noopener">
              <span class="list-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#25D366"><path d="M12 .5C5.65.5.5 5.65.5 12c0 2.11.55 4.16 1.6 5.97L.5 23.5l5.66-1.56A11.44 11.44 0 0 0 12 23.5c6.35 0 11.5-5.15 11.5-11.5S18.35.5 12 .5zm0 20.9c-1.83 0-3.62-.49-5.18-1.41l-.37-.22-3.36.92.9-3.28-.24-.38a9.53 9.53 0 0 1-1.45-5.03C2.3 6.48 6.65 2.1 12 2.1c5.34 0 9.7 4.38 9.7 9.8s-4.36 9.5-9.7 9.5zm5.32-7.13c-.29-.15-1.71-.84-1.97-.94-.27-.1-.46-.15-.65.15s-.945 1.176-1.159 1.421c-.215.248-.423.277-.785.096-.362-.181-1.528-.562-2.91-1.791-1.076-.962-1.8-2.144-2.012-2.505-.215-.362-.023-.558.159-.739.164-.163.362-.423.543-.634.181-.21.241-.362.362-.604.124-.248.062-.466-.03-.647-.091-.181-.824-1.996-1.13-2.725-.297-.715-.6-.619-.824-.629-.215-.009-.466-.011-.715-.011s-.647.091-.985.466c-.334.372-1.295 1.266-1.295 3.084 0 1.819 1.326 3.575 1.511 3.822.181.248 2.611 3.981 6.327 5.58.885.381 1.575.609 2.113.781.889.283 1.698.243 2.34.148.714-.106 2.145-.876 2.447-1.72.302-.843.302-1.562.211-1.72-.091-.163-.334-.248-.696-.429z"/></svg></span>
              <span class="list-text">Suporte AcheTece</span>
              <span class="arrow"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 6l6 6-6 6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
            </a>
          </nav>
        </div>
      </div>
    </section>
  </div>

  <!-- CTA (faixa preta) -->
  <section class="cta-bar" aria-label="Convite para cadastro">
    <div class="cta-text">
      <h3>É proprietário de uma malharia?</h3>
      <p>Cadastre sua malharia e comece a receber novos pedidos.</p>
    </div>
    <a href="{{ url_for('malharia_info') }}" class="cta-btn">Cadastrar</a>
  </section>

  <!-- Rodapé -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-brand"><img src="/static/logo_simbolo.png" alt="AcheTece"></div>
      <div class="footer-cols">
        <div class="footer-col">
          <h4>Sobre nós</h4>
          <ul>
            <li><a href="{{ url_for('quem_somos') }}">O AcheTece</a></li>
            <li><a href="{{ url_for('malharia_info') }}">Como funciona</a></li>
            <li><a href="{{ url_for('contato') }}">Fale conosco</a></li>
            <li><a href="{{ url_for('termos') }}">Termos e Políticas</a></li>
          </ul>
        </div>
        <div class="footer-col"><h4>&nbsp;</h4><ul><li>&nbsp;</li></ul></div>
      </div>
    </div>
  </footer>

  <!-- ===== SCRIPTS ===== -->
  <script>
    function updateQueryString(key, value){
      const url = new URL(window.location);
      url.searchParams.set(key, value);
      return url.pathname + url.search;
    }
  </script>

  <!-- Overlay menu -->
  <script>
    (function(){
      const overlay=document.getElementById('overlayMenu');
      const openBtn=document.getElementById('hamburgerBtn');
      const closeEls=overlay.querySelectorAll('[data-close]');
      function openMenu(){overlay.classList.add('is-open');overlay.setAttribute('aria-hidden','false');document.body.style.overflow='hidden';}
      function closeMenu(){overlay.classList.remove('is-open');overlay.setAttribute('aria-hidden','true');document.body.style.overflow='';}
      if(openBtn) openBtn.addEventListener('click',openMenu);
      closeEls.forEach(el=>el.addEventListener('click',closeMenu));
      document.addEventListener('keydown',e=>{ if(e.key==='Escape' && overlay.classList.contains('is-open')) closeMenu();});
      overlay.addEventListener('click',e=>{ if(e.target===overlay) closeMenu();});
    })();
  </script>

  <!-- Mobile: abrir/fechar painel de filtros -->
  <script>
    (function(){
      const btnMobile  = document.getElementById('toggleFiltersMobile');
      const panel = document.getElementById('filtersPanel');
      if(!panel) return;
      function toggle(){
        const open = panel.classList.toggle('is-open');
        document.body.classList.toggle('filters-open', open);
        if(btnMobile)  btnMobile.setAttribute('aria-expanded',  open ? 'true' : 'false');
      }
      if(btnMobile)  btnMobile.addEventListener('click',  toggle);
      panel.addEventListener('click', e => {
        if(e.target === panel && panel.classList.contains('is-open')) toggle();
      });
    })();
  </script>

  <!-- Localização: autocomplete + aplicação nos filtros -->
  <script>
  (function(){
    const $input = document.getElementById('input-localizacao');
    const $list  = document.getElementById('lista-sugestoes-localizacao');
    const $clear = document.querySelector('.typeahead-wrap.olx .olx-clear');
    if(!$input || !$list) return;
  
    // Debounce util
    function debounce(fn, wait){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); } }
  
    let hi = -1;
  
    // SVGs inline para consistência (OLX-like)
    const svgClock = `<svg class="ico" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8"/>
      <path d="M12 7v6l4 2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    const svgPin = `<svg class="ico" viewBox="0 0 24 24" fill="none">
      <path d="M12 22s7-6.2 7-12A7 7 0 1 0 5 10c0 5.8 7 12 7 12Z" stroke="currentColor" stroke-width="1.8"/>
      <circle cx="12" cy="10" r="2.8" stroke="currentColor" stroke-width="1.8"/></svg>`;
  
    function sectionTitle(txt){
      const li = document.createElement('li');
      li.className = 'typeahead-section-title';
      li.textContent = txt;
      return li;
    }
  
    function itemLi(icon, t1, t2, data){
      const li = document.createElement('li');
      li.className = 'typeahead-item';
      li.setAttribute('role','option');
      if(data){ Object.entries(data).forEach(([k,v])=> li.dataset[k]=v); }
      li.innerHTML = `${icon}<div class="txt"><span class="t1">${t1}</span>${t2?`<span class="t2">${t2}</span>`:''}</div>`;
      li.addEventListener('mousedown', (e)=>{
        e.preventDefault();
        const cidade = li.dataset.cidade;
        const uf = li.dataset.uf;
        if(cidade && uf){
          $input.value = `${cidade} - ${uf}`;
        } else if (li.dataset.fill){
          $input.value = li.dataset.fill;
        }
        hide();
      });
      return li;
    }
  
    function ctaBrasil(){
      const li = document.createElement('li');
      li.className = 'typeahead-cta';
      li.innerHTML = `<button type="button" class="btn-br">Em todo Brasil</button>`;
      li.querySelector('button').addEventListener('click', ()=>{
        $input.value = 'Brasil';
        hide();
      });
      return li;
    }
  
    function render(items){
      $list.innerHTML = '';
      hi = -1;
  
      if(items.length){
        $list.appendChild(sectionTitle('Sugestões'));
        items.forEach(it=>{
          const t1 = it.label || `${it.cidade} - ${it.uf}`;
          // Subtítulo: se tiver "regiao" no payload, mostra; senão usa UF como link
          const subt = it.regiao
            ? it.regiao
            : `<a href="javascript:void(0)">${it.uf}</a>`;
          const li = itemLi(svgPin, t1, subt, {cidade: it.cidade, uf: it.uf});
          $list.appendChild(li);
        });
      }else{
        $list.appendChild(sectionTitle('Nenhuma sugestão'));
        $list.appendChild(itemLi(svgClock, 'Digite mais letras', 'Use 2 ou mais caracteres'));
      }
  
      // Seção "Localização automática"
      $list.appendChild(sectionTitle('Localização automática'));
      $list.appendChild(itemLi(svgClock, 'Usar localização atual', 'Permita o navegador acessar sua localização', {fill:'Perto de mim'}));
      $list.appendChild(ctaBrasil());
  
      show();
    }
  
    function show(){ $list.classList.add('show'); }
    function hide(){ $list.classList.remove('show'); }
  
    const fetchSuggest = debounce(async function(){
      const q = $input.value.trim();
      if(q.length < 2){ hide(); return; }
      const ufParam = ($input.dataset.uf || '').trim();
      const url = new URL('/api/suggest/localizacao', window.location.origin);
      url.searchParams.set('q', q);
      if(ufParam) url.searchParams.set('uf', ufParam);
      url.searchParams.set('limit', '8');
  
      try{
        const r = await fetch(url, {headers:{'Accept':'application/json'}});
        const data = await r.json();
        render(Array.isArray(data)?data:[]);
      }catch(e){
        console.error(e);
        render([]);
      }
    }, 160);
  
    $input.addEventListener('input', fetchSuggest);
    $input.addEventListener('focus', ()=>{ if($input.value.trim().length>=2) fetchSuggest(); });
    $input.addEventListener('blur', ()=> setTimeout(hide, 120));
  
    // Teclado
    $input.addEventListener('keydown', (e)=>{
      const items = Array.from($list.querySelectorAll('.typeahead-item'));
      if(!$list.classList.contains('show') || !items.length) return;
  
      if(e.key==='ArrowDown'){ e.preventDefault(); hi=(hi+1)%items.length; mark(items); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); hi=(hi-1+items.length)%items.length; mark(items); }
      else if(e.key==='Enter'){ e.preventDefault(); if(hi>=0){ items[hi].dispatchEvent(new Event('mousedown')); } else hide(); }
      else if(e.key==='Escape'){ hide(); }
    });
  
    function mark(items){
      items.forEach((el,i)=>{
        el.setAttribute('aria-selected', i===hi ? 'true' : 'false');
        if(i===hi) el.scrollIntoView({block:'nearest'});
      });
    }
  
    // Botão limpar (X)
    if($clear){
      $clear.addEventListener('click', ()=>{
        $input.value='';
        $input.focus();
        hide();
      });
    }
  })();
  </script>

  <script>
  (function(){
    const input = document.getElementById('input-localizacao');
    const list  = document.getElementById('lista-sugestoes-localizacao');
    if(!input || !list) return;
  
    // Utilitário: debounce
    function debounce(fn, wait){
      let t;
      return function(...args){
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, args), wait);
      }
    }
  
    let highlightIndex = -1; // item focado pelo teclado
  
    function renderList(items){
      list.innerHTML = '';
      highlightIndex = -1;
  
      if(!items || !items.length){
        const li = document.createElement('li');
        li.className = 'typeahead-empty';
        li.textContent = 'Nenhuma sugestão';
        list.appendChild(li);
        list.classList.add('show');
        return;
      }
  
      items.forEach((it, idx) => {
        const li = document.createElement('li');
        li.className = 'typeahead-item';
        li.setAttribute('role', 'option');
        li.setAttribute('data-cidade', it.cidade);
        li.setAttribute('data-uf', it.uf);
  
        li.innerHTML = `<span class="pin"></span><span>${it.label}</span>`;
        li.addEventListener('mousedown', (e) => {
          // mousedown (e não click) evita perder o foco antes de setar
          e.preventDefault();
          input.value = it.cidade + ' - ' + it.uf;
          list.classList.remove('show');
        });
        list.appendChild(li);
      });
  
      list.classList.add('show');
    }
  
    const fetchSuggest = debounce(async function(){
      const q = input.value.trim();
      if(q.length < 2){ // só começa a sugerir com 2+ letras
        list.classList.remove('show');
        return;
      }
      const ufParam = (input.dataset.uf || '').trim(); // opcional: filtra por UF atual
      const url = new URL('/api/suggest/localizacao', window.location.origin);
      url.searchParams.set('q', q);
      if(ufParam) url.searchParams.set('uf', ufParam);
      url.searchParams.set('limit', '10');
  
      try{
        const resp = await fetch(url.toString(), { headers: { 'Accept': 'application/json' }});
        const data = await resp.json();
        renderList(data);
      }catch(err){
        console.error('Falha ao buscar sugestões:', err);
        renderList([]);
      }
    }, 180); // debounce ~180ms
  
    input.addEventListener('input', fetchSuggest);
  
    // Fecha a lista ao perder o foco (com pequeno delay p/ permitir clique)
    input.addEventListener('blur', () => {
      setTimeout(() => list.classList.remove('show'), 120);
    });
  
    // Navegação por teclado
    input.addEventListener('keydown', (e) => {
      const items = Array.from(list.querySelectorAll('.typeahead-item'));
      if(!list.classList.contains('show') || !items.length) return;
  
      if(e.key === 'ArrowDown'){
        e.preventDefault();
        highlightIndex = (highlightIndex + 1) % items.length;
        updateHighlight(items);
      }else if(e.key === 'ArrowUp'){
        e.preventDefault();
        highlightIndex = (highlightIndex - 1 + items.length) % items.length;
        updateHighlight(items);
      }else if(e.key === 'Enter'){
        e.preventDefault();
        if(highlightIndex >= 0){
          const li = items[highlightIndex];
          const cidade = li.getAttribute('data-cidade');
          const uf     = li.getAttribute('data-uf');
          input.value = `${cidade} - ${uf}`;
          list.classList.remove('show');
        }else{
          list.classList.remove('show');
        }
      }else if(e.key === 'Escape'){
        list.classList.remove('show');
      }
    });
  
    function updateHighlight(items){
      items.forEach((el, i) => {
        el.setAttribute('aria-selected', i === highlightIndex ? 'true' : 'false');
        if(i === highlightIndex){
          el.scrollIntoView({ block: 'nearest' });
        }
      });
    }
  })();
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const ufSelect = document.getElementById('local-estado');
    const cidadeSelect = document.getElementById('local-cidade');
  
    async function carregarCidades(uf, preselecionada = '') {
      if (!uf) {
        cidadeSelect.innerHTML = '<option value="">Selecione a cidade</option>';
        return;
      }
      cidadeSelect.innerHTML = '<option value="">Carregando...</option>';
      try {
        const resp = await fetch(`/api/cidades?uf=${encodeURIComponent(uf)}`);
        if (!resp.ok) throw new Error('Falha na resposta da API');
        const cidades = await resp.json();
  
        const options = ['<option value="">Selecione a cidade</option>']
          .concat(cidades.map(c => {
            const sel = (preselecionada && preselecionada === c) ? ' selected' : '';
            return `<option value="${c.replace(/"/g,'&quot;')}"${sel}>${c}</option>`;
          }));
        cidadeSelect.innerHTML = options.join('');
      } catch (err) {
        console.error(err);
        cidadeSelect.innerHTML = '<option value="">Falha ao carregar cidades</option>';
      }
    }
  
    ufSelect.addEventListener('change', () => {
      carregarCidades(ufSelect.value);
    });
  
    // Pré-carrega se já veio preenchido
    const ufInicial = ufSelect.value;
    const cidadeInicial = cidadeSelect.getAttribute('data-inicial') || '';
    if (ufInicial) {
      carregarCidades(ufInicial, cidadeInicial);
    }
  });
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const ufSel     = document.getElementById('estado_lookup');
    const cidSel    = document.getElementById('cidade_lookup');
    const ufHidden  = document.getElementById('estado_hidden');  // pode não existir se você já tiver os names no form
    const cidHidden = document.getElementById('cidade_hidden');
  
    // Preenche os “names” de submissão (hidden) sem conflitar com a coluna esquerda
    function mirrorToHidden(){
      if (ufHidden)  ufHidden.value  = ufSel.value || '';
      if (cidHidden) cidHidden.value = cidSel.value || '';
    }
  
    async function carregarCidades(uf, preselecionada = '') {
      if (!uf) {
        cidSel.innerHTML = '<option value="" disabled selected>Selecione a cidade</option>';
        cidSel.disabled = true;
        mirrorToHidden();
        return;
      }
      cidSel.disabled = true;
      cidSel.innerHTML = '<option value="" disabled selected>Carregando...</option>';
      try {
        const resp = await fetch(`/api/cidades?uf=${encodeURIComponent(uf)}`);
        if (!resp.ok) throw new Error('Falha na API');
        const cidades = await resp.json();
  
        const opts = ['<option value="" disabled selected>Selecione a cidade</option>']
          .concat(cidades.map(c => {
            const sel = (preselecionada && preselecionada === c) ? ' selected' : '';
            return `<option value="${c.replace(/"/g,'&quot;')}"${sel}>${c}</option>`;
          }));
        cidSel.innerHTML = opts.join('');
        cidSel.disabled = false;
  
        // Se pré-selecionou cidade, já espelha no hidden
        mirrorToHidden();
      } catch (e) {
        console.error(e);
        cidSel.innerHTML = '<option value="" disabled selected>Falha ao carregar cidades</option>';
        cidSel.disabled = true;
      }
    }
  
    // Ao mudar a UF, recarrega as cidades e limpa cidade
    ufSel.addEventListener('change', () => {
      carregarCidades(ufSel.value);
      // limpa city espelhada
      if (cidHidden) cidHidden.value = '';
      mirrorToHidden();
    });
  
    // Ao escolher cidade, espelha
    cidSel.addEventListener('change', mirrorToHidden);
  
    // --- PRÉ-CARGA: usa querystring ?estado=SC&cidade=Jaraguá%20do%20Sul se existir ---
    const qs = new URLSearchParams(location.search);
    const ufQS  = qs.get('estado') || '';
    const cidQS = qs.get('cidade') || '';
    if (ufQS) {
      // tenta selecionar a UF vinda na URL
      const opt = Array.from(ufSel.options).find(o => o.value === ufQS);
      if (opt) opt.selected = true;
    }
    const cidadeInicial = cidSel.getAttribute('data-inicial') || cidQS || '';
    if (ufSel.value) {
      carregarCidades(ufSel.value, cidadeInicial);
    } else {
      // sem UF escolhida, garante cidade bloqueada
      carregarCidades('');
    }
  
    // espelha estado/cidade mesmo quando página abre
    mirrorToHidden();
  });
  </script>
  
</body>
</html>
