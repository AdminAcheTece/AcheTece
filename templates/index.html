<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>AcheTece - Portal de Malharias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- √çcone da aba (favicon) -->
  <link rel="icon" type="image/x-icon" href="/static/favicon_final.ico">
  <link rel="icon" type="image/png" href="/static/favicon_final.png">

  <!-- CSS principal -->
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --roxo:#8A00FF; --roxo-hover:#A63DFF; --preto:#000;
      --procura-bg: #F2E8FF;   --procura-fg: #7A1BFF;
      --malharia-bg: #E6FCF4;  --malharia-fg: #0BA98B;
    }

    /* ===== Topo e promo ===== */
    .navbar{overflow:visible;padding:6px 0;display:flex;align-items:center;}
    .header-left,.header-right{display:flex;align-items:center;}
    .header-right{margin-left:auto;gap:20px;}
    .hamburger{display:inline-flex;flex-direction:column;align-items:center;justify-content:center;width:40px;height:40px;border:none;background:transparent;cursor:pointer}
    .hamburger span{display:block;width:20px;height:2px;background:var(--preto);border-radius:2px}
    .hamburger span+span{margin-top:4px}
    .promo-bar{background:#000;color:#fff;display:flex;align-items:center;justify-content:center;gap:12px;padding:6px 10px;font-size:14px}
    .promo-cta{display:inline-block;background:var(--roxo);color:#fff;text-decoration:none;padding:6px 10px;border-radius:8px;font-weight:600}
    .promo-cta:hover{background:var(--roxo-hover);transform:translateY(-1px)}

    /* ===== Layout (filtros + resultados) ===== */
    .page-outer{max-width:1280px;margin:0 auto;padding:0 16px}
    .search-layout{display:grid;grid-template-columns:300px 1fr;gap:24px;align-items:start;margin:10px 0 0}
    @media (max-width:1024px){.search-layout{grid-template-columns:1fr}}

    /* Filtros (mantidos) */
    .filters-panel{
      border:1px solid #eee;border-radius:14px;padding:16px;background:#fff;
      position:sticky;top:56px;max-height:calc(100vh - 72px);overflow:auto
    }
    .filters-title{margin:0 0 12px;font-size:18px;font-weight:700}
    .filter-field{margin-bottom:12px}
    .filter-field label{display:block;font-size:14px;margin-bottom:6px;color:#444}
    .filter-field select{width:100%;height:40px;padding:8px 10px;border:1px solid #ccc;border-radius:10px;background:#fff}
    .filter-actions .btn-primary{width:100%;height:48px;border:0;border-radius:999px;background:var(--roxo);color:#fff;font-weight:800}
    .link-reset{display:inline-block;margin-top:10px;font-size:14px;color:#6a6a6a;text-decoration:underline}

    /* Drawer mobile dos filtros */
    @media (max-width:1024px){
      .filters-panel{position:fixed;left:0;top:0;bottom:0;width:min(90%,360px);max-width:90vw;border-radius:0;padding:16px;transform:translateX(-110%);transition:transform .2s ease;z-index:1001;max-height:none;overflow:auto}
      .filters-panel.is-open{transform:translateX(0)}
      body.filters-open{overflow:hidden}
    }

    /* ===== Barra mobile estilo OLX: Localiza√ß√£o + Filtros + P√≠lula ===== */
    .mobile-controls{display:none;border-top:1px solid #eee;border-bottom:1px solid #eee;background:#fff}
    .mobile-controls-inner{max-width:1280px;margin:0 auto;padding:10px 16px}
    .location-row{display:flex;align-items:center;gap:8px;font-size:14px;color:#333;margin-bottom:8px}
    .location-row select{border:0;background:#f7f7f7;border-radius:10px;padding:8px 10px}
    .toolbar-row{display:flex;gap:10px;align-items:center}
    .btn-filtros{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e5e5;background:#fff;border-radius:12px;padding:10px 14px;font-weight:700}
    .btn-filtros svg{width:18px;height:18px}
    .filter-pill{display:inline-flex;align-items:center;border:2px solid #e5d3ff;background:#f3e9ff;color:#5525a5;border-radius:12px;padding:10px 14px;font-weight:600;min-height:40px;max-width:70vw;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    @media (max-width:1024px){.mobile-controls{display:block}}

    /* ===== Cabe√ßalho de resultados (desktop) ===== */
    .right-col{min-width:0}
    .loc-card{background:#f6f7f9;border-radius:12px;border:1px solid #eceff3;padding:14px;margin-bottom:14px}
    .loc-field{display:flex;align-items:center;gap:10px;border:1px solid #dfe3e8;background:#fff;border-radius:12px;padding:12px 14px}
    .loc-left{display:flex;align-items:center;gap:8px;color:#333;font-weight:600}
    .loc-clear{margin-left:auto;background:transparent;border:0;cursor:pointer;font-size:18px;line-height:1}
    .results-head h1{margin:8px 0 6px;font-size:clamp(20px,2.8vw,28px)}
    .results-sub{color:#5b5b5b;margin-bottom:12px}
    .results-toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .results-toolbar .select{height:40px;border:1px solid #dfe3e8;border-radius:10px;background:#fff;padding:8px 12px}

    /* ===== √Årea de resultados ===== */
    .results-panel .tabela-container{border:1px solid #eee;border-radius:12px;overflow:auto;background:#fff}
    .paginacao{display:flex;gap:12px;align-items:center;justify-content:center;margin:14px 0}
    .paginacao a{color:var(--roxo);text-decoration:none;font-weight:700}

    /* Bot√£o desktop antigo (n√£o usamos mais, s√≥ fallback) */
    .filters-toggle{display:none}
  </style>
</head>
<body>

  <!-- Promo topo -->
  <section class="promo-bar" aria-label="Oferta para malharias">
    <span><strong>Malharia:</strong> receba agora novos pedidos por apenas <strong>R$49,90/m√™s</strong>.</span>
    <a class="promo-cta" href="/malharia_info">Saiba como</a>
  </section>

  <!-- Cabe√ßalho -->
  <header class="navbar">
    <div class="header-left">
      <div class="logo">
        <img src="/static/logo.jpg" alt="Logo AcheTece" decoding="async" fetchpriority="high">
      </div>
    </div>
    <div class="header-right">
      <button class="hamburger" id="hamburgerBtn" type="button" aria-label="Abrir menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- CONTROLES MOBILE (OLX-like) -->
  <div class="mobile-controls">
    <div class="mobile-controls-inner">
      <!-- Linha 1: Localiza√ß√£o -->
      <div class="location-row">
        <span aria-hidden="true">üìç</span>
        <label for="loc-mobile" class="sr-only">Localiza√ß√£o</label>
        <!-- Integre estes selects com seu backend se desejar -->
        <select id="loc-mobile" name="localizacao">
          <option value="">Buscando em todo o Brasil</option>
          <option value="SC">Santa Catarina</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="PR">Paran√°</option>
        </select>
      </div>
      <!-- Linha 2: Filtros + p√≠lula-resumo -->
      <div class="toolbar-row">
        <button class="btn-filtros" id="toggleFiltersMobile" aria-controls="filtersPanel" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M6 12h12M10 18h4" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          Filtros
        </button>
        {% set ativos = [] %}
        {% for k,v in filtros.items() %}{% if v %}{% set _ = ativos.append(k|capitalize ~ ': ' ~ v) %}{% endif %}{% endfor %}
        <div class="filter-pill" title="{{ ativos|join(', ') if ativos else 'Todos os teares' }}">
          {{ ativos|join(' ‚Ä¢ ') if ativos else 'Todos os teares' }}
        </div>
      </div>
    </div>
  </div>

  <!-- P√°gina em 2 colunas -->
  <div class="page-outer">
    <div class="search-layout">

      <!-- COLUNA ESQUERDA: FILTROS (mantidos) -->
      <aside class="filters-panel" id="filtersPanel">
        <h2 class="filters-title">Filtrar teares</h2>
        <form method="POST" class="formulario" action="{{ url_for('index') }}">
          {% for campo, opcoes_campo in opcoes.items() %}
            <div class="filter-field">
              <label for="{{ campo }}">{{ campo|capitalize }}</label>
              <select name="{{ campo }}" id="{{ campo }}">
                <option value="">-- Todos --</option>
                {% for opcao in opcoes_campo %}
                  <option value="{{ opcao }}" {% if filtros[campo] == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
          <div class="filter-actions">
            <button type="submit" class="btn-primary">Buscar</button>
            <a href="{{ url_for('index') }}" class="link-reset">Limpar</a>
          </div>
        </form>
      </aside>

      <!-- COLUNA DIREITA: RESULTADOS (estilo OLX) -->
      <div class="right-col">
        <!-- Cart√£o de Localiza√ß√£o (desktop) -->
        <section class="loc-card" aria-label="Localiza√ß√£o">
          <div style="font-weight:700; color:#222; margin-bottom:8px;">Localiza√ß√£o <span style="background:linear-gradient(90deg,#a335ff,#ff7a00);color:#fff;border-radius:12px;padding:2px 8px;font-size:12px;margin-left:6px;">Novo</span></div>
          <div class="loc-field">
            <div class="loc-left">
              <span aria-hidden="true">üìç</span>
              <span id="loc-label">Brasil</span>
            </div>
            <button class="loc-clear" type="button" aria-label="Limpar localiza√ß√£o" title="Limpar">√ó</button>
          </div>
        </section>

        <!-- Cabe√ßalho de resultados -->
        <header class="results-head">
          <h1>Teares dispon√≠veis</h1>
          <div class="results-sub">
            {% set _total = total_resultados if total_resultados is defined else (resultados|length if resultados else 0) %}
            {% if _total and _total > 0 %}
              1 - {{ resultados|length if resultados else 0 }} de {{ _total }} resultados
            {% else %}
              Ajuste os filtros para ver resultados.
            {% endif %}
          </div>

          <div class="results-toolbar">
            <label for="ordenar" style="font-weight:600;color:#333">Ordenar por</label>
            <select id="ordenar" class="select" name="ordenar" onchange="location.search = updateQueryString('ordenar', this.value)">
              {% set ord = request.args.get('ordenar', 'relevancia') %}
              <option value="relevancia" {% if ord=='relevancia' %}selected{% endif %}>Mais relevantes</option>
              <option value="novos" {% if ord=='novos' %}selected{% endif %}>Mais recentes</option>
              <option value="antigos" {% if ord=='antigos' %}selected{% endif %}>Mais antigos</option>
            </select>
          </div>
        </header>

        <!-- Lista/Tabela de resultados -->
        <section id="busca" class="results-panel">
          {% if resultados %}
            <div class="tabela-container">
              <!-- SUA TABELA / LISTA DE RESULTADOS AQUI (mantida do backend) -->
              {{ tabela_html|safe if tabela_html is defined else '' }}
            </div>

            <!-- Pagina√ß√£o -->
            <div class="paginacao">
              {% if pagina > 1 %}
                <a href="?pagina={{ pagina - 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">‚Üê Anterior</a>
              {% endif %}
              P√°gina {{ pagina }} de {{ total_paginas }}
              {% if pagina < total_paginas %}
                <a href="?pagina={{ pagina + 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">Pr√≥xima ‚Üí</a>
              {% endif %}
            </div>

            <!-- Exporta√ß√£o -->
            <form action="/exportar" method="get" style="margin:10px 0">
              {% for campo, valor in filtros.items() %}
                {% if valor %}
                  <input type="hidden" name="{{ campo }}" value="{{ valor }}">
                {% endif %}
              {% endfor %}
              <button type="submit" class="btn-primary" style="width:auto;padding:10px 16px;border-radius:12px">Exportar CSV</button>
            </form>
          {% else %}
            <div style="background:#fff;border:1px solid #eee;border-radius:12px;padding:18px">
              <strong>Nenhum resultado</strong><br>
              Tente flexibilizar alguns filtros ou limpar a localiza√ß√£o.
            </div>
          {% endif %}
        </section>
      </div>
    </div>
  </div>

  <!-- Modal / Sheet (menu) ‚Äî mantido -->
  <div id="overlayMenu" class="overlay-menu" aria-hidden="true">
    <div class="overlay-backdrop" data-close></div>
    <section class="overlay-panel" role="dialog" aria-modal="true" aria-labelledby="overlayMenuTitle">
      <header class="overlay-header">
        <h2 id="overlayMenuTitle">Menu</h2>
        <button class="overlay-close" type="button" aria-label="Fechar" data-close>√ó</button>
      </header>
      <div class="overlay-content">
        <!-- Coloque aqui o conte√∫do do seu menu (mantido do seu projeto) -->
        <div>Em breve</div>
      </div>
    </section>
  </div>

  <!-- Rodap√© enxuto -->
  <footer class="site-footer" style="margin-top:24px">
    <div class="footer-inner">
      <div class="footer-brand"><img src="/static/logo_simbolo.png" alt="AcheTece"></div>
      <div class="footer-cols">
        <div class="footer-col">
          <h4>Sobre n√≥s</h4>
          <ul>
            <li><a href="/quem_somos">O AcheTece</a></li>
            <li><a href="/malharia_info">Como funciona</a></li>
            <li><a href="/contato">Fale conosco</a></li>
            <li><a href="/termos">Termos e Pol√≠ticas</a></li>
          </ul>
        </div>
        <div class="footer-col"><h4>&nbsp;</h4><ul><li>&nbsp;</li></ul></div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // util: atualiza querystring de forma simples
    function updateQueryString(key, value){
      const url = new URL(window.location);
      url.searchParams.set(key, value);
      return url.pathname + url.search;
    }
  </script>

  <script>
    // Menu overlay
    (function(){
      const overlay=document.getElementById('overlayMenu');
      const openBtn=document.getElementById('hamburgerBtn');
      const closeEls=overlay.querySelectorAll('[data-close]');
      function openMenu(){overlay.classList.add('is-open');overlay.setAttribute('aria-hidden','false');document.body.style.overflow='hidden'}
      function closeMenu(){overlay.classList.remove('is-open');overlay.setAttribute('aria-hidden','true');document.body.style.overflow=''}
      if(openBtn) openBtn.addEventListener('click',openMenu);
      closeEls.forEach(el=>el.addEventListener('click',closeMenu));
      document.addEventListener('keydown',e=>{ if(e.key==='Escape' && overlay.classList.contains('is-open')) closeMenu()});
      overlay.addEventListener('click',e=>{ if(e.target===overlay) closeMenu()});
    })();
  </script>

  <!-- Toggle dos filtros (desktop fallback + mobile OLX-like) -->
  <script>
    (function(){
      const btnDesktop = document.getElementById('toggleFilters');        // se existir
      const btnMobile  = document.getElementById('toggleFiltersMobile');   // mobile
      const panel = document.getElementById('filtersPanel');
      if(!panel) return;

      function toggle(){
        const open = panel.classList.toggle('is-open');
        document.body.classList.toggle('filters-open', open);
        if(btnDesktop) btnDesktop.setAttribute('aria-expanded', open ? 'true' : 'false');
        if(btnMobile)  btnMobile.setAttribute('aria-expanded',  open ? 'true' : 'false');
      }

      if(btnDesktop) btnDesktop.addEventListener('click', toggle);
      if(btnMobile)  btnMobile.addEventListener('click',  toggle);

      panel.addEventListener('click', e => { if(e.target === panel && panel.classList.contains('is-open')) toggle() });
    })();
  </script>

  <!-- A√ß√µes da Localiza√ß√£o (demo) -->
  <script>
    (function(){
      const clear = document.querySelector('.loc-clear');
      const label = document.getElementById('loc-label');
      if(clear && label){
        clear.addEventListener('click', ()=>{
          label.textContent='Brasil';
          // aqui voc√™ pode redirecionar limpando filtros de estado/cidade, se quiser
          // location.href = updateQueryString('estado','');
        });
      }
    })();
  </script>

</body>
</html>
