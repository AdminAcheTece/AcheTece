<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>{{ lesson.title }} - Treinamento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_final.ico') }}">
</head>

<body class="header-v1">
  <main style="max-width:1100px;margin:22px auto;padding:0 14px;">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:14px;flex-wrap:wrap;">
      <div style="max-width:820px;">
        <div style="color:#666;font-weight:800;">{{ module.title }}</div>
        <h1 style="margin:6px 0 8px 0;">{{ lesson.title }}</h1>
        <div style="color:#555;line-height:1.5;">{{ lesson.summary }}</div>

        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
          {% if status == "done" %}
            <span style="padding:6px 10px;border-radius:999px;background:#ecfdf5;border:1px solid #86efac;font-weight:900;color:#065f46;">Concluída</span>
          {% elif status == "in_progress" %}
            <span style="padding:6px 10px;border-radius:999px;background:#eff6ff;border:1px solid #93c5fd;font-weight:900;color:#1e3a8a;">Em andamento</span>
          {% else %}
            <span style="padding:6px 10px;border-radius:999px;background:#f8fafc;border:1px solid #e5e7eb;font-weight:900;color:#111;">Não iniciada</span>
          {% endif %}
          <span style="padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #e5e7eb;font-weight:900;color:#111;">⏱ {{ lesson.minutes }} min</span>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:10px;min-width:240px;">
        <form method="post" action="{{ url_for('treinamento_concluir', module_key=module.key, lesson_key=lesson.key) }}">
          <button type="submit"
                  style="width:100%;border:none;cursor:pointer;font-weight:900;border-radius:999px;padding:12px 14px;background:#111;color:#fff;">
            Marcar como concluída
          </button>
        </form>

        <a href="{{ url_for('treinamento_modulo', module_key=module.key) }}"
           style="text-decoration:none;text-align:center;font-weight:900;border-radius:999px;padding:10px 14px;border:1px solid #111;color:#111;background:#fff;">
          ← Voltar ao módulo
        </a>

        <a href="{{ url_for('painel_malharia') }}"
           style="text-decoration:none;text-align:center;font-weight:900;border-radius:999px;padding:10px 14px;border:1px solid #111;color:#111;background:#fff;">
          ← Voltar ao painel
        </a>
      </div>
    </div>

    {% if file_url %}
    <section style="margin-top:14px;border:1px solid #e5e7eb;border-radius:16px;background:#fff;overflow:hidden;">
      <div style="padding:12px 14px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
        <div style="font-weight:900;">Material da aula (PDF protegido)</div>
        <a href="{{ file_url }}" target="_blank"
           style="text-decoration:none;font-weight:900;border-radius:999px;padding:8px 12px;background:#7B7424;color:#fff;">
          Abrir em nova guia
        </a>
      </div>
      <div style="padding:0;">
        <iframe src="{{ file_url }}" style="width:100%;height:75vh;border:0;"></iframe>
      </div>
    </section>
    {% endif %}

    {% if lesson.quiz %}
    <section style="margin-top:14px;border:1px solid #e5e7eb;border-radius:16px;background:#fff;padding:14px;">
      <h2 style="margin:0 0 10px 0;">Mini-quiz</h2>
      <form method="post" action="{{ url_for('treinamento_quiz', module_key=module.key, lesson_key=lesson.key) }}">
        {% for q in lesson.quiz %}
          <div style="padding:12px;border:1px solid #f1f5f9;border-radius:14px;margin-bottom:10px;">
            <div style="font-weight:900;margin-bottom:8px;">{{ loop.index }}. {{ q.q }}</div>
            {% for opt in q.options %}
              <label style="display:block;margin:6px 0;cursor:pointer;">
                <input type="radio" name="q{{ loop.parent.index0 }}" value="{{ loop.index0 }}" required>
                <span style="margin-left:8px;">{{ opt }}</span>
              </label>
            {% endfor %}
          </div>
        {% endfor %}

        <button type="submit"
                style="border:none;cursor:pointer;font-weight:900;border-radius:999px;padding:12px 14px;background:#111;color:#fff;">
          Enviar quiz
        </button>
      </form>
    </section>
    {% endif %}
  </main>
</body>
</html>
