<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel da Malharia</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_final.ico') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon_final.png') }}">

    <style>
        :root{ --roxo:#8A00FF; --roxo-hover:#A63DFF; }
        th, td { text-align: center; }

        .btn-roxo{ display:inline-flex; align-items:center; justify-content:center;
          height:40px; padding:0 16px; border:0; border-radius:9999px;
          background:var(--roxo); color:#fff; font-weight:700; font-size:14px;
          text-decoration:none; cursor:pointer; transition:.2s; }
        .btn-roxo:hover{ background:var(--roxo-hover); transform:translateY(-1px); }
        .btn-roxo:focus-visible{ outline:3px solid rgba(138,0,255,.25); outline-offset:2px; }

        .botao-editar{ background-color: var(--roxo); color:#fff; padding:6px 12px;
          font-size:13px; border-radius:9999px; text-decoration:none; display:inline-block; }
        .botao-editar:hover{ background-color: var(--roxo-hover); }

        .btn-perigo{ display:inline-flex; align-items:center; justify-content:center;
          height:32px; padding:0 12px; border:0; border-radius:9999px;
          background:#e53935; color:#fff; font-weight:700; cursor:pointer; }
        .btn-perigo:hover{ filter:brightness(.95); }

        .table-wrapper{ overflow-x:auto; margin-top:18px; }
        table{ width:100%; border-collapse:collapse; background-color:#fff; }
        th, td{ padding:10px; border:1px solid #ccc; }

        .logo{ text-align:center; margin-top:12px; }
        .logo img{ max-height:72px; }

        h1.titulo{ text-align:center; margin:6px 0 4px; }
        h2{ margin:0; }

        /* container geral */
        .container{ max-width:1100px; margin:0 auto; padding:0 16px 28px; }

        /* Cabeçalho da seção da tabela */
        .sec-title{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; }

        /* === NOVO topo moderno (hero) === */
        .hero-card{
          max-width:1100px; margin:14px auto 8px;
          background:#fff; border:1px solid rgba(0,0,0,.06);
          border-radius:22px; padding:18px 18px;
          box-shadow:0 8px 28px rgba(0,0,0,.06);
          display:grid; grid-template-columns:1.3fr 1fr; gap:20px; align-items:center;
        }
        @media (max-width: 920px){ .hero-card{ grid-template-columns:1fr; } }
        
        .hero-ident{ display:flex; gap:14px; align-items:flex-start; min-width:0; }
        .hero-avatar{
          width:64px; height:64px; border-radius:50%;
          background: radial-gradient(120% 120% at 10% 10%, #f1efff, #efe7ff 60%, #e9e3ff 100%);
          display:grid; place-items:center; flex:0 0 64px; border:1px solid #eee;
        }
        .hero-avatar svg{ width:30px; height:30px; stroke:var(--roxo); fill:none; stroke-width:1.8; }
        .hero-nome{ font-size:1.25rem; font-weight:800; color:#161616; line-height:1.2; }
        .hero-email{ color:#6b6b6b; font-size:.95rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:block; }
        
        .hero-chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
        .chip{
          display:inline-flex; align-items:center; gap:8px; height:32px; padding:0 12px;
          border-radius:999px; font-weight:700; font-size:.85rem; border:1px solid transparent;
        }
        .chip-ativa{ background:#e8f7ed; color:#137a2a; }
        .chip-pendente{ background:#fff3e7; color:#b85e00; }
        .chip-link{ background:#f4f0ff; color:#5f0adf; border-color:#ece6ff; text-decoration:none; }
        
        .hero-actions{ display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap; }
        .btn-outline{
          display:inline-flex; align-items:center; justify-content:center;
          height:40px; padding:0 14px; border-radius:9999px;
          border:1.5px solid #e3e3e7; background:#fff; color:#1f1f1f; font-weight:700; text-decoration:none;
        }
        .btn-outline:hover{ background:#fafafa; }
        
        .btn-ghost{
          display:inline-flex; align-items:center; justify-content:center;
          height:40px; padding:0 14px; border-radius:9999px; border:0;
          background:#f7f7fb; color:#2a2a2a; font-weight:700; text-decoration:none;
        }
        .btn-ghost:hover{ background:#efeff7; }

        /* mini métricas discretas */
        .hero-metrics{ display:flex; gap:16px; margin-top:10px; }
        .hero-metric{ display:flex; flex-direction:column; align-items:flex-start; }
        .hero-metric strong{ font-size:1.05rem; }
        .hero-metric span{ font-size:.8rem; color:#777; }

        /* ===== Novos botões: WhatsApp e Laranja ===== */
        .btn-whatsapp{
          display:inline-flex; align-items:center; justify-content:center;
          height:40px; padding:0 14px; border-radius:9999px; border:0;
          background:var(--verde-whats, #25D366); color:#fff; font-weight:700; text-decoration:none;
        }
        .btn-whatsapp:hover{ filter:brightness(.95); transform:translateY(-1px); }
        .btn-whatsapp:focus-visible{ outline:3px solid rgba(37,211,102,.35); outline-offset:2px; }

        .btn-laranja{
          display:inline-flex; align-items:center; justify-content:center;
          height:40px; padding:0 14px; border-radius:9999px; border:0;
          background:var(--laranja, #ff7a00); color:#fff; font-weight:700; text-decoration:none;
        }
        .btn-laranja:hover{ filter:brightness(.95); transform:translateY(-1px); }
        .btn-laranja:focus-visible{ outline:3px solid rgba(255,122,0,.30); outline-offset:2px; }
    </style>
</head>
<body>

<header>
  <div class="logo">
    <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo AcheTece">
  </div>
</header>

{% set nome_empresa =
    (empresa.apelido if empresa and empresa.apelido else
     (empresa.nome_fantasia if empresa and empresa.nome_fantasia else
      (empresa.razao_social if empresa and empresa.razao_social else 'Minha Malharia'))) %}
{% set _assin_ativa = (assinatura_ativa if assinatura_ativa is defined else False) %}
{% set lista_teares =
    (teares if teares is defined and teares is not none
     else (empresa.teares if empresa and empresa.teares else [])) %}

<div class="container">
  <h1 class="titulo">Painel da Malharia</h1>
  <p style="text-align:center;">Bem-vindo(a), <strong>{{ nome_empresa }}</strong>!</p>

  <!-- ===== Topo moderno ===== -->
  <div class="hero-card">
    <!-- Identidade + status -->
    <div class="hero-col-left">
      <div class="hero-ident">
        <div class="hero-avatar">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"></circle><path d="M4 20c0-4 4-7 8-7s8 3 8 7"></path></svg>
        </div>
        <div class="hero-info" style="min-width:0;">
          <div class="hero-nome">{{ nome_empresa }}</div>
          <span class="hero-email">{{ empresa.email if empresa else '' }}</span>

          <div class="hero-chips">
            {% if empresa %}
              {% if _assin_ativa %}
                <span class="chip chip-ativa">Assinatura ativa</span>
                <a class="chip chip-link" href="{{ url_for('checkout', plano=empresa.plano or 'mensal') }}">Gerenciar pagamento</a>
              {% else %}
                <span class="chip chip-pendente">Assinatura pendente</span>
                <a class="chip chip-link" href="{{ url_for('checkout', plano='mensal') }}">Ativar plano (Mensal)</a>
              {% endif %}
            {% else %}
              <span class="chip chip-pendente">Cadastre sua malharia</span>
              <a class="chip chip-link" href="{{ url_for('cadastrar_empresa') }}">Criar cadastro</a>
            {% endif %}
          </div>

          <!-- mini métricas (opcional) -->
          <div class="hero-metrics">
            <div class="hero-metric"><strong>0</strong><span>Buscas</span></div>
            <div class="hero-metric"><strong>0</strong><span>Contatos</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ações rápidas -->
    <div class="hero-col-right">
      <div class="hero-actions">
        {% if empresa %}
          <a href="{{ url_for('editar_empresa') }}" class="btn-outline">Editar Perfil</a>
        {% else %}
          <a href="{{ url_for('cadastrar_empresa') }}" class="btn-roxo">Cadastrar minha malharia</a>
        {% endif %}
        <a href="{{ url_for('fale_conosco') }}" class="btn-whatsapp">Suporte AcheTece</a>
        <a href="{{ url_for('logout') }}" class="btn-laranja" title="Encerrar sessão">Sair</a>
        {% if session.get('admin') %}
          <a href="{{ url_for('admin_empresas') }}" class="btn-ghost">Admin</a>
        {% endif %}
      </div>
    </div>
  </div>
  <!-- ===== /Topo moderno ===== -->

  <!-- Cabeçalho da tabela (sem botão de teares) -->
  <div class="sec-title">
    <h2>Teares Cadastrados:</h2>
    <a href="{{ url_for('teares_form') }}" class="btn-roxo"> + Cadastrar Teares</a>
  </div>
    
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Marca</th><th>Modelo</th><th>Tipo</th>
          <th>Finura</th><th>Diâmetro</th>
          <th>Alimentadores</th><th>Elastano</th>
        </tr>
      </thead>
      <tbody>
        {% if lista_teares|length %}
          {% for tear in lista_teares %}
          <tr>
            <td>{{ tear.marca or '-' }}</td>
            <td>{{ tear.modelo or '-' }}</td>
            <td>{{ tear.tipo or '-' }}</td>
            <td>{{ tear.finura if tear.finura is not none else '-' }}</td>
            <td>{{ tear.diametro if tear.diametro is not none else '-' }}</td>
            <td>{{ tear.alimentadores if tear.alimentadores is not none else '-' }}</td>
            <td>{{ 'Sim' if (tear.elastano or tear.kit_elastano) else 'Não' }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7">Nenhum tear cadastrado ainda.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  {# Removido o aviso sobre DEMO/botão de teares #}
</div>
</body>
</html>
