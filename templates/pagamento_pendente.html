<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Pagamento Pendente - AcheTece</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Ícone da aba (favicon) -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_final.ico') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon_final.png') }}">

    <style>
      :root{
        /* Paleta OLIVE (padrão novo) */
        --olive:#7B7424;
        --olive-600:#5E581C;
        --olive-dark:#434326;
        --olive-50:#F1F2E8;
        --line-olive:#BFBFA8;
    
        /* Destaque neon para CTAs */
        --lime:#B6F34D;
        --lime-700:#A2E532;
    
        /* Fundo global igual à index */
        --site-bg:#EAEAE8;
      }
    
      html, body{
        margin:0;
        background:var(--site-bg);
        color:#1f1f1f;
        font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
      }
    
      .logo{ text-align:center; margin:16px 0 8px; }
      .logo img{ max-height:72px; height:auto; width:auto; display:inline-block; }
    
      .container{
        max-width:600px;
        margin:40px auto;
        background:#fff;
        padding:28px 22px;
        border-radius:14px;
        border:1px solid #e8ecf5;
        box-shadow:none;
        text-align:center;
      }
    
      h1{
        color:#ff9800; /* estado pendente */
        margin:8px 0 6px;
        font-size:24px;
        line-height:1.2;
        font-weight:800;
      }
    
      p{ color:#555; font-size:16px; margin:8px 0 18px; }
      .hint{ color:#666; font-size:14px; margin-top:10px; }
      .muted{ color:#777; font-size:13px; }
    
      /* ===== BOTÕES: PRETO → LIME no hover (sem bordas) ===== */
      .btn,
      .botao-acao,
      button,
      a.button,
      a.botao-acao{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        min-height:44px;
        padding:10px 20px;
        border:0;
        border-radius:9999px;
        background:#000;
        color:var(--lime);
        font-weight:800;
        font-size:16px;
        text-decoration:none;
        cursor:pointer;
        transition: background-color .15s ease, color .15s ease, transform .12s ease;
        box-shadow:none !important;
      }
      .btn:hover,
      .botao-acao:hover,
      button:hover,
      a.button:hover,
      a.botao-acao:hover{
        background:var(--lime);
        color:#000;
        transform:translateY(-2px);
      }
      .btn:active,
      .botao-acao:active,
      button:active,
      a.button:active,
      a.botao-acao:active{
        background:var(--lime-700);
        color:#000;
        transform:translateY(0);
      }
    
      /* Sem “anel” no hover / clique do mouse */
      .btn:focus:not(:focus-visible),
      .botao-acao:focus:not(:focus-visible),
      button:focus:not(:focus-visible),
      a.button:focus:not(:focus-visible),
      a.botao-acao:focus:not(:focus-visible){
        outline:none;
        box-shadow:none;
      }
    
      /* Acessível ao teclado */
      .btn:focus-visible,
      .botao-acao:focus-visible,
      button:focus-visible,
      a.button:focus-visible,
      a.botao-acao:focus-visible{
        outline:2px solid var(--lime);
        outline-offset:2px;
      }
    
      @media (max-width:480px){
        .container{ margin:24px 12px; padding:24px 16px; }
      }
    </style>
</head>
<body>

    <div class="container" role="status" aria-live="polite">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo AcheTece">
        </div>

        <h1>Pagamento Pendente</h1>

        {% if empresa %}
            <p>Olá, <strong>{{ empresa.apelido or empresa.nome }}</strong>. Ainda não identificamos a compensação do seu pagamento.</p>
        {% else %}
            <p>Olá! Ainda não identificamos a compensação do seu pagamento.</p>
        {% endif %}

        <p>
            Isso pode acontecer com <strong>boleto</strong> (compensação em horas ou até 1 dia útil) ou <strong>Pix em análise</strong>.
            Assim que o pagamento for confirmado, seu acesso será liberado automaticamente.
        </p>

        <a href="{{ url_for('pagar') }}" class="botao-acao">Tentar pagar novamente</a>
        <div class="hint" id="hint">Estamos verificando periodicamente. Você será redirecionado quando o acesso estiver liberado.</div>

        <noscript>
            <p class="muted">Ative o JavaScript para verificação automática. Você pode tentar novamente pelo botão acima.</p>
        </noscript>
    </div>

    <script>
    (function () {
        // Faz polling do status e redireciona ao ficar "ativo"
        const urlParams = new URLSearchParams(window.location.search);
        const ext = urlParams.get('ext'); // opcional, melhora robustez em caso de sessão perdida
        const maxTries = 120; // ~ 8 minutos (120 * 4s)
        let tries = 0;

        async function checarStatus() {
            try {
                const qs = ext ? ("?ext=" + encodeURIComponent(ext)) : "";
                const res = await fetch("/api/pagamento_status" + qs, { cache: "no-store" });
                if (res.ok) {
                    const js = await res.json();
                    if (js && js.status === "ativo") {
                        window.location.href = "/login"; // ou sua rota de painel autenticado
                        return;
                    }
                }
            } catch (e) {
                // Silencia erros intermitentes (rede, etc.)
            }
            tries++;
            if (tries < maxTries) {
                setTimeout(checarStatus, 4000);
            } else {
                const hint = document.getElementById("hint");
                if (hint) {
                    hint.textContent = "Se preferir, clique em “Tentar pagar novamente” ou retorne mais tarde.";
                }
            }
        }

        // Inicia checagem alguns segundos após carregar
        setTimeout(checarStatus, 4000);
    })();
    </script>

</body>
</html>
