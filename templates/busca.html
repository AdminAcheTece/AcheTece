<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Buscar Teares - AcheTece</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* === Base mantida === */
        body{ font-family:'Inter',sans-serif; background:#f2f2f2; margin:0; color:#444; }

        /* ===== Cabeçalho (igual ao index) ===== */
        header{ background:#fff; border-bottom:1px solid #e6e6e6; padding:10px 16px; position:sticky; top:0; z-index:1000; }
        .navbar{ max-width:1200px; margin:0 auto; display:flex; align-items:center; position:relative; }
        .header-left{ display:flex; align-items:center; gap:10px; }
        .logo img{ display:block; max-height:60px; height:auto; width:auto; }
        .header-right{ margin-left:auto; display:flex; align-items:center; gap:10px; }

        .icon-btn{
          display:inline-flex; align-items:center; justify-content:center;
          width:36px; height:36px; border:1px solid #e4e4e4; border-radius:10px;
          background:#fff; cursor:pointer; transition:box-shadow .2s, transform .02s, background .2s;
        }
        .icon-btn:hover{ box-shadow:0 2px 8px rgba(0,0,0,.06); background:#f7f7f7; }
        .icon-btn:active{ transform:translateY(1px); }
        .icon{ width:20px; height:20px; color:#222; }

        /* ===== Menu suspenso (compatível mesmo sem CSS externo) ===== */
        .menu-overlay{
          position:fixed; inset:0; background:rgba(0,0,0,.08);
          opacity:0; pointer-events:none; transition:opacity .18s ease;
        }
        .menu-overlay[data-open="true"]{ opacity:1; pointer-events:auto; }

        .menu-panel{
          position:absolute; top:56px; right:16px;
          width:260px; background:#fff; border:1px solid #e9e9e9; border-radius:12px;
          box-shadow:0 12px 28px rgba(0,0,0,.12);
          opacity:0; transform:translateY(-6px); pointer-events:none; transition:opacity .18s ease, transform .18s ease;
        }
        .menu-panel[data-open="true"]{ opacity:1; transform:translateY(0); pointer-events:auto; }

        .menu-head{
          display:flex; align-items:center; justify-content:space-between;
          padding:10px 12px; border-bottom:1px solid #f0f0f0; background:#f8f8f8; border-radius:12px 12px 0 0;
        }
        .menu-title{ font-weight:600; font-size:14px; color:#222; }
        .menu-close{ width:28px; height:28px; border:1px solid #e4e4e4; border-radius:8px; background:#fff; cursor:pointer; }

        .menu-list{ list-style:none; margin:0; padding:8px; }
        .menu-list a{
          display:block; padding:10px 12px; border-radius:8px; text-decoration:none; color:#222; font-size:15px;
        }
        .menu-list a:hover{ background:#f5f7ff; color:#003bb3; }

        /* ===== Resto da página (seu layout original) ===== */
        .container{ max-width:1200px; margin:30px auto; padding:0 20px; }
        h1{ text-align:center; margin-bottom:30px; color:#003bb3; }

        form.formulario{
          display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px;
          background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.05);
        }
        .campo{ flex:1 1 200px; display:flex; flex-direction:column; }
        label{ font-weight:bold; margin-bottom:5px; color:#003bb3; } /* corrigido */
        select{ padding:10px; border-radius:6px; border:1px solid #ccc; }

        .botoes{ display:flex; align-items:flex-end; gap:10px; }
        button,.botao-cancelar{
          background:#003bb3; color:#fff; padding:10px 16px; border:none; border-radius:6px; font-weight:bold; cursor:pointer;
          text-decoration:none; min-width:120px; text-align:center; height:35px; font-family:'Inter',sans-serif; font-size:14px;
        }
        .botao-cancelar{ background:#444; }

        .tabela-container{ overflow-x:auto; }
        table{ width:100%; border-collapse:collapse; margin-top:20px; background:#fff; border-radius:8px; overflow:hidden; min-width:800px; }
        th,td{ padding:12px; text-align:center; border-bottom:1px solid #ccc; }
        th{ background:#eee; color:#003bb3; }

        .paginacao{ text-align:center; margin-top:20px; }
        .paginacao a{ margin:0 10px; text-decoration:none; color:#003bb3; font-weight:bold; }

        .btn-whatsapp{ background:#25D366; color:#fff; padding:6px 12px; border-radius:6px; text-decoration:none; font-weight:bold; display:inline-block; font-size:14px; min-width:100px; }
        .btn-whatsapp:hover{ background:#1ebe5b; }

        @media (min-width:768px){
          form.formulario{ gap:16px; }
          .campo{ flex:1 1 calc(20% - 16px); }
        }
    </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header>
    <div class="navbar">
      <!-- Esquerda: LOGO -->
      <div class="header-left">
        <a class="logo" href="/">
          <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo AcheTece">
        </a>
      </div>

      <!-- Direita: CASINHA (interna) + SANDUÍCHE -->
      <div class="header-right">
        <!-- Home -->
        <a href="/" class="icon-btn" aria-label="Página inicial" title="Página inicial">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 10.5 12 3l9 7.5"></path><path d="M5 10v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V10"></path><path d="M9 21V12h6v9"></path>
          </svg>
        </a>

        <!-- Sanduíche -->
        <button id="menu-toggle" class="icon-btn" aria-expanded="false" aria-controls="menu-panel" aria-label="Abrir menu" title="Menu">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="18" x2="20" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Painel do menu (igual ao index) -->
      <div id="menu-panel" class="menu-panel" role="menu" aria-hidden="true" data-open="false">
        <div class="menu-head">
          <span class="menu-title">Menu</span>
          <button class="menu-close" id="menu-close" aria-label="Fechar menu">✕</button>
        </div>
        <ul class="menu-list">
          <li><a href="/busca" role="menuitem">Ache o tear aqui</a></li>
          <li><a href="/cadastrar_malharia" role="menuitem">Cadastrar malharia</a></li>
          <li><a href="/login" role="menuitem">Já sou cadastrado</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Overlay para clique-fora -->
  <div id="menu-overlay" class="menu-overlay" data-open="false"></div>

  <!-- ===== Conteúdo de busca ===== -->
  <div class="container">
    <h1>Buscar Teares</h1>

    <p class="frase-instrucao">
      Use os filtros abaixo para encontrar a malharia e o tear que atendem à sua demanda de produção.
    </p>

    <form method="POST" class="formulario">
      {% for campo, opcoes_campo in opcoes.items() %}
      <div class="campo">
        <label for="{{ campo }}">{{ campo|capitalize }}:</label>
        <select name="{{ campo }}" id="{{ campo }}">
          <option value="">-- Todos --</option>
          {% for opcao in opcoes_campo %}
          <option value="{{ opcao }}" {% if filtros[campo] == opcao %}selected{% endif %}>{{ opcao }}</option>
          {% endfor %}
        </select>
      </div>
      {% endfor %}

      <div class="botoes">
        <button type="submit">Buscar</button>
        <a href="/busca" class="botao-cancelar">Limpar</a>
      </div>
    </form>

    {% if resultados %}
    <div class="tabela-container">
      <table>
        <thead>
          <tr>
            <th>Empresa</th><th>Tipo</th><th>Diâmetro</th><th>Galga</th><th>Alimentadores</th><th>Estado</th><th>Cidade</th><th>Contato</th>
          </tr>
        </thead>
        <tbody>
          {% for linha in resultados %}
          <tr>
            <td>{{ linha['Empresa'] }}</td>
            <td>{{ linha['Tipo'] }}</td>
            <td>{{ linha['Diâmetro'] }}</td>
            <td>{{ linha['Galga'] }}</td>
            <td>{{ linha['Alimentadores'] }}</td>
            <td>{{ linha['Estado'] }}</td>
            <td>{{ linha['Cidade'] }}</td>
            <td>
              {% if linha['Telefone']|length >= 10 %}
                <a class="btn-whatsapp" href="https://wa.me/55{{ linha['Telefone'] }}?text={{ linha['Mensagem'] | urlencode }}" target="_blank">WhatsApp</a>
              {% else %}Telefone inválido{% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="paginacao">
      {% if pagina > 1 %}
        <a href="?pagina={{ pagina - 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">← Anterior</a>
      {% endif %}
      Página {{ pagina }} de {{ total_paginas }}
      {% if pagina < total_paginas %}
        <a href="?pagina={{ pagina + 1 }}{% for k, v in filtros.items() if v %}&{{ k }}={{ v }}{% endfor %}">Próxima →</a>
      {% endif %}
    </div>

    <form action="/exportar" method="get">
      {% for campo, valor in filtros.items() %}
        {% if valor %}
          <input type="hidden" name="{{ campo }}" value="{{ valor }}">
        {% endif %}
      {% endfor %}
      <button type="submit">Exportar CSV</button>
    </form>
    {% endif %}
  </div>

  <script>
    // Abrir/fechar menu (mesmo comportamento do index)
    const btnToggle = document.getElementById('menu-toggle');
    const panel     = document.getElementById('menu-panel');
    const btnClose  = document.getElementById('menu-close');
    const overlay   = document.getElementById('menu-overlay');

    function setMenu(open){
      panel.dataset.open   = open ? 'true' : 'false';
      overlay.dataset.open = open ? 'true' : 'false';
      panel.setAttribute('aria-hidden', open ? 'false' : 'true');
      btnToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      if(open) panel.querySelector('a,button')?.focus();
    }

    btnToggle?.addEventListener('click', ()=> setMenu(panel.dataset.open!=='true'));
    btnClose?.addEventListener('click', ()=> setMenu(false));
    overlay?.addEventListener('click', ()=> setMenu(false));
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') setMenu(false); });
  </script>
</body>
</html>
