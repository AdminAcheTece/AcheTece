<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Perfil da Malharia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon_final.png') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />

  <style>
    :root{
      --bg:#F8FAFC; --surface:#FFFFFF; --line:#E5E7EB;
      --text:#111827; --muted:#6B7280;
      --accent:#6E59F2; --accent-strong:#5946E6;
      --pill-bg:#EEF2F7; --shadow:0 6px 20px rgba(0,0,0,.06);
      --radius-lg:14px; --radius-md:12px;
    }

    html,body{height:100%}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    a{ color:var(--accent); text-decoration:none; }
    a:hover{ color:var(--accent-strong); text-decoration:underline; }

    .navbar{
      padding:10px 12px; display:flex; align-items:center;
      background:var(--surface); border-bottom:1px solid var(--line);
    }
    .logo a{ display:inline-flex; align-items:center; text-decoration:none; }
    .logo img{ height:44px; width:auto; display:block; }
    @media (max-width:900px){ .logo img{ height:50px; } }

    .wrap{ max-width:1100px; margin:0 auto; padding:16px; }

    .card{
      background:var(--surface); border:1px solid var(--line);
      border-radius:var(--radius-lg); box-shadow:var(--shadow);
      padding:18px; margin:14px 0;
    }

    .head{ display:grid; grid-template-columns:1fr auto; gap:16px; align-items:start; }
    @media (max-width:720px){ .head{ grid-template-columns:1fr; } }
    .title{ margin:0; font-size:26px; font-weight:700; letter-spacing:.2px; }
    .sub{ margin:6px 0 0; color:var(--muted); font-size:14px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px; height:28px; padding:0 12px;
      background:var(--pill-bg); border:1px solid var(--line); border-radius:9999px;
      font-weight:600; font-size:12.5px; color:#334155;
    }

    .actions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      height:38px; padding:0 14px; gap:8px; border-radius:9999px;
      border:1px solid var(--line); background:#fff; color:var(--text);
      font-weight:600; text-decoration:none; transition:.16s ease; cursor:pointer;
    }
    .btn:hover{ border-color:#D1D5DB; background:#F9FAFB; text-decoration:none; }

    .btn-link{
      display:inline-flex; align-items:center; gap:8px; padding:0 8px; height:36px;
      border-radius:8px; color:var(--text); background:transparent; border:1px solid transparent;
      font-weight:600;
    }
    .btn-link:hover{ background:#F3F4F6; border-color:#E5E7EB; text-decoration:none; }

    .icon-btn{
      width:38px; height:38px; display:inline-flex; align-items:center; justify-content:center;
      border:1px solid var(--line); border-radius:9999px; background:#fff; transition:.16s ease;
    }
    .icon-btn:hover{ border-color:#D1D5DB; background:#F9FAFB; }
    .icon{ width:18px; height:18px; display:block; }

    .sec-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin:0 0 10px; }
    h2.sec{ font-size:18px; margin:0; font-weight:700; }

    .empresa-grid{ display:grid; grid-template-columns:1.1fr .9fr; gap:18px; align-items:start; }
    @media (max-width:900px){ .empresa-grid{ grid-template-columns:1fr; } }

    dl.dados{
      display:grid; grid-template-columns:160px 1fr; gap:10px 14px;
      border:1px solid var(--line); border-radius:var(--radius-md);
      padding:14px; background:var(--surface);
    }
    .dados dt{
      font-size:12px; text-transform:uppercase; letter-spacing:.04em;
      color:var(--muted); font-weight:700;
    }
    .dados dd{ margin:0; font-size:15px; font-weight:600; color:var(--text); }
    /* >>> padronização pedida: mesmo estilo da linha "Rua..." para o nome */
    .value-strong{ font-weight:700; color:var(--text); }
    .addr .linha{ display:block; }
    .addr .rua{ font-weight:700; color:var(--text); }  /* garante mesma cor/força */
    .addr .local, .addr .cep{ color:#374151; font-weight:600; }

    .mapa{ border:1px solid var(--line); border-radius:var(--radius-md); overflow:hidden; background:var(--surface); }
    .mapa iframe{ width:100%; height:220px; border:0; display:block; }
    .mapa small{ display:block; padding:8px 10px; color:var(--muted); }

    .table-wrap{ overflow-x:auto; border:1px solid var(--line); border-radius:var(--radius-md); background:var(--surface); }
    table{ width:100%; border-collapse:collapse; }
    thead th{ background:#F3F4F6; font-weight:700; font-size:13px; color:#374151; }
    th, td{ padding:10px 12px; border-bottom:1px solid #EEF2F7; font-size:14px; vertical-align:middle; }
    thead th, tbody td{ text-align:center; }
    tbody tr:nth-child(even){ background:#FAFAFA; }
    tbody tr:hover{ background:#F6F7F9; }

    .footer-spacer{ height:8px; }
    .sr-only{ position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0; }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <a href="{{ url_for('index') }}" aria-label="Página inicial">
        <img src="{{ url_for('static', filename='logo.jpg') }}" alt="AcheTece">
      </a>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="head">
        <div>
          <h1 class="title">{{ empresa.apelido or empresa.nome_fantasia or empresa.razao_social or 'Malharia' }}</h1>
          <p class="sub">
            {% if empresa.cidade %}{{ empresa.cidade }}{% if empresa.estado %}/{{ empresa.estado }}{% endif %}{% endif %}
            {% if teares %}&nbsp;•&nbsp;<span class="pill">{{ teares|length }} tear(es)</span>{% endif %}
          </p>
        </div>
        <div class="actions">
          {% set _fone = empresa.telefone or empresa.contato_telefone or empresa.celular %}
          {% set _wa = empresa.contato_whatsapp or (('https://wa.me/' ~ ('55' ~ _fone if _fone and not _fone.startswith('55') else _fone)) if _fone else None) %}
          {% if _wa %}
            <a class="icon-btn" href="{{ _wa }}" target="_blank" rel="noopener" title="WhatsApp">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M20.52 3.48A11.9 11.9 0 0 0 12.06 0C5.48 0 .16 5.33.16 11.92c0 2.1.55 4.16 1.6 5.98L0 24l6.3-1.64a11.9 11.9 0 0 0 5.76 1.47h.01c6.58 0 11.9-5.33 11.9-11.92 0-3.18-1.24-6.17-3.45-8.43ZM12.06 21.3h-.01c-1.84 0-3.64-.49-5.2-1.41l-.37-.22-3.74.97.99-3.64-.24-.37A9.73 9.73 0 0 1 2.34 11.9c0-5.37 4.36-9.73 9.72-9.73 2.6 0 5.04 1.01 6.88 2.86a9.65 9.65 0 0 1 2.85 6.87c0 5.37-4.36 9.73-9.72 9.73Zm5.37-7.28c-.29-.15-1.7-.84-1.97-.93-.27-.1-.47-.15-.66.14-.2.29-.76.94-.93 1.13-.17.2-.34.22-.63.08-.29-.15-1.23-.45-2.34-1.43-.86-.76-1.44-1.7-1.61-1.99-.17-.29-.02-.45.13-.6.14-.14.29-.34.43-.51.15-.17.2-.29.29-.49.1-.2.05-.37-.02-.52-.07-.15-.66-1.61-.9-2.2-.24-.58-.49-.5-.66-.51h-.57c-.2 0-.52.07-.8.37-.27.29-1.05 1.02-1.05 2.49 0 1.46 1.08 2.88 1.23 3.08.15.2 2.12 3.24 5.13 4.55.72.31 1.29.49 1.73.63.73.23 1.39.2 1.91.12.58-.09 1.7-.69 1.94-1.36.24-.66.24-1.24.17-1.36-.07-.12-.26-.19-.55-.34Z"/>
              </svg>
              <span class="sr-only">WhatsApp</span>
            </a>
          {% endif %}
          <a class="btn" href="{{ url_for('index') }}">Voltar</a>
        </div>
      </div>
    </section>

    {% set _logradouro = empresa.endereco or empresa.logradouro or empresa.endereco_completo %}
    {% set _numero     = empresa.numero %}
    {% set _bairro     = empresa.bairro %}
    {% set _cidade     = empresa.cidade %}
    {% set _estado     = empresa.estado %}
    {% set _cep        = empresa.cep %}
    {% set tem_end = _logradouro or _numero or _bairro or _cidade or _estado or _cep %}
    {% set endereco_full = (
      (_logradouro or '') ~
      (', ' ~ _numero if _numero else '') ~
      (', ' ~ _bairro if _bairro else '') ~
      (', ' ~ _cidade if _cidade else '') ~
      ( '/' ~ _estado if _estado else '') ~
      ( ' • CEP ' ~ _cep if _cep else '')
    ).strip().strip(',') %}
    {% set mapa_q = (endereco_full or ((_cidade or '') ~ ' ' ~ (_estado or ''))) | replace(' ', '+') %}
    {% set map_url = 'https://www.google.com/maps?q=' ~ mapa_q %}

    <section class="card">
      <div class="sec-head">
        <h2 class="sec">Informações da empresa</h2>
        {% if tem_end %}
          <a class="btn-link" href="{{ map_url }}" target="_blank" rel="noopener" title="Abrir no Google Maps">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"/>
            </svg>
            <span>Ver no Maps</span>
          </a>
        {% endif %}
      </div>

      <div class="empresa-grid">
        <dl class="dados">
          {% set _pn = empresa.contato_nome or empresa.responsavel_nome or empresa.responsavel %}
          {% set _sn = empresa.contato_sobrenome or empresa.responsavel_sobrenome %}
          {% set pessoa_contato = ((_pn or '') ~ (' ' ~ _sn if _sn else '')).strip() %}
          <dt>Pessoa de contato</dt>
          <dd><span class="value-strong">{{ pessoa_contato if pessoa_contato else '—' }}</span></dd>

          <dt>Telefone</dt>
          <dd>
            {% set _fone_local = empresa.telefone or empresa.contato_telefone or empresa.celular %}
            {% if _fone_local %}
              {# normaliza e formata (DDD) nnnnn-nnnn | (DDD) nnnn-nnnn #}
              {% set _raw = (_fone_local|string) %}
              {% set d = _raw|replace(' ','')|replace('(','')|replace(')','')|replace('-','')|replace('.','')|replace('+','') %}
              {% if d.startswith('55') and d|length > 11 %}{% set d = d[2:] %}{% endif %}
              {% if d|length == 11 %}
                {% set ddd = d[:2] %}{% set A = d[2:7] %}{% set B = d[7:] %}
              {% elif d|length == 10 %}
                {% set ddd = d[:2] %}{% set A = d[2:6] %}{% set B = d[6:] %}
              {% else %}
                {% set ddd = d[:2] %}{% set A = d[2:-4] %}{% set B = d[-4:] %}
              {% endif %}
              {% set fone_fmt = '(' ~ ddd ~ ') ' ~ A ~ ('-' ~ B if B else '') %}
              <a href="tel:{{ '55' ~ d if not d.startswith('55') else d }}">{{ fone_fmt }}</a>
            {% else %}—{% endif %}
          </dd>

          <dt>E-mail</dt>
          <dd>
            {% set _email = empresa.email or empresa.contato_email %}
            {% if _email %}<a href="mailto:{{ _email }}">{{ _email }}</a>{% else %}—{% endif %}
          </dd>

          <dt>Endereço</dt>
          <dd>
            {% if tem_end %}
              <div class="addr">
                <span class="linha rua">
                  {{ _logradouro or '' }}{% if _numero %}, {{ _numero }}{% endif %}{% if _bairro %} – {{ _bairro }}{% endif %}
                </span>
                <span class="linha local">
                  {{ _cidade or '' }}{% if _estado %}/{{ _estado }}{% endif %}
                  {% if _cep %}<span class="cep"> • CEP {{ _cep }}</span>{% endif %}
                </span>
              </div>
            {% else %}
              —
            {% endif %}
          </dd>
        </dl>

        <div class="mapa">
          {% if tem_end %}
            <iframe loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="{{ map_url }}&output=embed"></iframe>
            <small>Localização aproximada com base no endereço cadastrado.</small>
          {% else %}
            <div style="padding:14px;">Sem endereço cadastrado para exibir no mapa.</div>
          {% endif %}
        </div>
      </div>
    </section>

    <section class="card">
      <h2 class="sec">Teares desta malharia</h2>
      {% if teares and teares|length %}
        <div class="table-wrap" role="region" aria-label="Lista de teares" tabindex="0">
          <table>
            <thead>
              <tr>
                <th>Tipo</th><th>Galga</th><th>Diâmetro</th><th>Alimentadores</th><th>Elastano</th>
              </tr>
            </thead>
            <tbody>
              {% for t in teares %}
                <tr>
                  <td>{{ t.tipo or '—' }}</td>
                  <td>{{ t.finura or t.galga or '—' }}</td>
                  <td>{{ t.diametro or '—' }}</td>
                  <td>{{ t.alimentadores or '—' }}</td>
                  <td>
                    {% set raw = t.elastano if (t.elastano is not none) else t.kit_elastano %}
                    {% if raw is boolean %}
                      {{ 'Sim' if raw else 'Não' }}
                    {% else %}
                      {% set s = (raw|string).strip().lower() %}
                      {% if s in ['sim','s','true','t','on','1','com','tem','yes','y'] %}
                        Sim
                      {% elif s in ['não','nao','n','false','f','off','0','sem','no'] %}
                        Não
                      {% else %}
                        —
                      {% endif %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div>Nenhum tear cadastrado para esta empresa.</div>
      {% endif %}
    </section>

    <div class="footer-spacer"></div>
  </main>
</body>
</html>
